---
title: Hurdle lognormal distribution densities?
author: Michael Flynn
date: '2021-03-03'
slug: []
categories:
  - Blogging
  - stats
tags:
  - blogging
  - stats
---

<script src="{{< blogdown/postref >}}index_files/header-attrs/header-attrs.js"></script>


<p>As a part of a larger project I’ve been working with BRMS and some models and family functions that are new to me. In particular, my work on troop deployments has made me think more about hurdle models. I’ve had some experience with zero-inflated models in the past, but haven’t spent a lot of time with hurdle models, specifically. Anyway, without going down the rabbit hole, I’ve been thinking about how to create probability density functions for some of these models. The <code>{countreg}</code> package contains some functions for hurdle negative binomial models, which got me thinking about building something similar for hurdle lognormal distributions. I’m really operating one the frontiers of my own experience/abilities, so I may be way off here, but let’s give this a shot and see if it works.</p>
<div id="background" class="section level1">
<h1>Background</h1>
<p>I work a lot with military deployment data. Typically these are country-year observations of the number of US military personnel stationed in various overseas locations (think Germany, Japan, etc.). So far most of our work has treated deployments as a predictor variable, but more recently we’ve started thinking more about modeling deployment levels themselves. In general, there tends to be a ton of skew in these data. For example, from 1990 forward the troop deployment data we have are more or less distributed like this:</p>
<pre class="r"><code># Simulation parameters
sims &lt;- 1e4
muval = 2.8
sdval = 2.54
pival = 0.2


simvals &lt;- rep(NA, sims)
simvals[c(1:2000)] &lt;- rep(0, sims*0.2)
simvals[c(2001:10000)] &lt;- rlnorm(sims*0.8, meanlog = muval, sdlog = sdval)

plot &lt;- hist(log1p(simvals), breaks = 200)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<pre class="r"><code>plot</code></pre>
<pre><code>## $breaks
##   [1]  0.00  0.05  0.10  0.15  0.20  0.25  0.30  0.35  0.40  0.45  0.50  0.55
##  [13]  0.60  0.65  0.70  0.75  0.80  0.85  0.90  0.95  1.00  1.05  1.10  1.15
##  [25]  1.20  1.25  1.30  1.35  1.40  1.45  1.50  1.55  1.60  1.65  1.70  1.75
##  [37]  1.80  1.85  1.90  1.95  2.00  2.05  2.10  2.15  2.20  2.25  2.30  2.35
##  [49]  2.40  2.45  2.50  2.55  2.60  2.65  2.70  2.75  2.80  2.85  2.90  2.95
##  [61]  3.00  3.05  3.10  3.15  3.20  3.25  3.30  3.35  3.40  3.45  3.50  3.55
##  [73]  3.60  3.65  3.70  3.75  3.80  3.85  3.90  3.95  4.00  4.05  4.10  4.15
##  [85]  4.20  4.25  4.30  4.35  4.40  4.45  4.50  4.55  4.60  4.65  4.70  4.75
##  [97]  4.80  4.85  4.90  4.95  5.00  5.05  5.10  5.15  5.20  5.25  5.30  5.35
## [109]  5.40  5.45  5.50  5.55  5.60  5.65  5.70  5.75  5.80  5.85  5.90  5.95
## [121]  6.00  6.05  6.10  6.15  6.20  6.25  6.30  6.35  6.40  6.45  6.50  6.55
## [133]  6.60  6.65  6.70  6.75  6.80  6.85  6.90  6.95  7.00  7.05  7.10  7.15
## [145]  7.20  7.25  7.30  7.35  7.40  7.45  7.50  7.55  7.60  7.65  7.70  7.75
## [157]  7.80  7.85  7.90  7.95  8.00  8.05  8.10  8.15  8.20  8.25  8.30  8.35
## [169]  8.40  8.45  8.50  8.55  8.60  8.65  8.70  8.75  8.80  8.85  8.90  8.95
## [181]  9.00  9.05  9.10  9.15  9.20  9.25  9.30  9.35  9.40  9.45  9.50  9.55
## [193]  9.60  9.65  9.70  9.75  9.80  9.85  9.90  9.95 10.00 10.05 10.10 10.15
## [205] 10.20 10.25 10.30 10.35 10.40 10.45 10.50 10.55 10.60 10.65 10.70 10.75
## [217] 10.80 10.85 10.90 10.95 11.00 11.05 11.10 11.15 11.20 11.25 11.30 11.35
## [229] 11.40 11.45 11.50 11.55 11.60 11.65 11.70 11.75 11.80 11.85 11.90 11.95
## [241] 12.00 12.05 12.10 12.15 12.20 12.25 12.30
## 
## $counts
##   [1] 2082  100   91   94   81   70   75   70   77   89   54   56   74   80   75
##  [16]   71   80   68   62   58   52   69   68   67   84   73   69   75   67   60
##  [31]   67   72   70   75   90   61   75   67   67   78   70   71   82   62   69
##  [46]   83   70   66   55   64   77   53   56   75   60   64   66   66   57   67
##  [61]   70   79   69   69   66   53   65   60   60   56   72   68   57   67   60
##  [76]   61   56   67   62   47   69   60   57   52   56   68   61   67   48   57
##  [91]   39   45   44   50   43   41   44   40   61   31   45   33   39   40   35
## [106]   38   33   35   44   32   40   45   30   32   29   31   22   25   29   28
## [121]   21   20   24   22   27   29   20   19   28   16   22   23   22   22   14
## [136]   15   10   18   17   17    8   13   15   19   14   17   10    9   10   12
## [151]   10    7   14    8   10   10    3    6    9    5    5   10    6    5    6
## [166]    3    6    6    8    5    9    3    9    3    3    4    6    2    3    3
## [181]    2    1    4    1    2    1    1    3    0    1    1    2    2    2    2
## [196]    0    0    0    3    0    0    2    2    2    0    1    1    0    0    0
## [211]    1    1    3    0    0    1    1    1    1    0    1    0    0    3    0
## [226]    0    0    0    0    0    0    0    0    0    0    0    1    0    0    0
## [241]    0    0    0    1    0    1
## 
## $density
##   [1] 4.164 0.200 0.182 0.188 0.162 0.140 0.150 0.140 0.154 0.178 0.108 0.112
##  [13] 0.148 0.160 0.150 0.142 0.160 0.136 0.124 0.116 0.104 0.138 0.136 0.134
##  [25] 0.168 0.146 0.138 0.150 0.134 0.120 0.134 0.144 0.140 0.150 0.180 0.122
##  [37] 0.150 0.134 0.134 0.156 0.140 0.142 0.164 0.124 0.138 0.166 0.140 0.132
##  [49] 0.110 0.128 0.154 0.106 0.112 0.150 0.120 0.128 0.132 0.132 0.114 0.134
##  [61] 0.140 0.158 0.138 0.138 0.132 0.106 0.130 0.120 0.120 0.112 0.144 0.136
##  [73] 0.114 0.134 0.120 0.122 0.112 0.134 0.124 0.094 0.138 0.120 0.114 0.104
##  [85] 0.112 0.136 0.122 0.134 0.096 0.114 0.078 0.090 0.088 0.100 0.086 0.082
##  [97] 0.088 0.080 0.122 0.062 0.090 0.066 0.078 0.080 0.070 0.076 0.066 0.070
## [109] 0.088 0.064 0.080 0.090 0.060 0.064 0.058 0.062 0.044 0.050 0.058 0.056
## [121] 0.042 0.040 0.048 0.044 0.054 0.058 0.040 0.038 0.056 0.032 0.044 0.046
## [133] 0.044 0.044 0.028 0.030 0.020 0.036 0.034 0.034 0.016 0.026 0.030 0.038
## [145] 0.028 0.034 0.020 0.018 0.020 0.024 0.020 0.014 0.028 0.016 0.020 0.020
## [157] 0.006 0.012 0.018 0.010 0.010 0.020 0.012 0.010 0.012 0.006 0.012 0.012
## [169] 0.016 0.010 0.018 0.006 0.018 0.006 0.006 0.008 0.012 0.004 0.006 0.006
## [181] 0.004 0.002 0.008 0.002 0.004 0.002 0.002 0.006 0.000 0.002 0.002 0.004
## [193] 0.004 0.004 0.004 0.000 0.000 0.000 0.006 0.000 0.000 0.004 0.004 0.004
## [205] 0.000 0.002 0.002 0.000 0.000 0.000 0.002 0.002 0.006 0.000 0.000 0.002
## [217] 0.002 0.002 0.002 0.000 0.002 0.000 0.000 0.006 0.000 0.000 0.000 0.000
## [229] 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.002 0.000 0.000 0.000
## [241] 0.000 0.000 0.000 0.002 0.000 0.002
## 
## $mids
##   [1]  0.025  0.075  0.125  0.175  0.225  0.275  0.325  0.375  0.425  0.475
##  [11]  0.525  0.575  0.625  0.675  0.725  0.775  0.825  0.875  0.925  0.975
##  [21]  1.025  1.075  1.125  1.175  1.225  1.275  1.325  1.375  1.425  1.475
##  [31]  1.525  1.575  1.625  1.675  1.725  1.775  1.825  1.875  1.925  1.975
##  [41]  2.025  2.075  2.125  2.175  2.225  2.275  2.325  2.375  2.425  2.475
##  [51]  2.525  2.575  2.625  2.675  2.725  2.775  2.825  2.875  2.925  2.975
##  [61]  3.025  3.075  3.125  3.175  3.225  3.275  3.325  3.375  3.425  3.475
##  [71]  3.525  3.575  3.625  3.675  3.725  3.775  3.825  3.875  3.925  3.975
##  [81]  4.025  4.075  4.125  4.175  4.225  4.275  4.325  4.375  4.425  4.475
##  [91]  4.525  4.575  4.625  4.675  4.725  4.775  4.825  4.875  4.925  4.975
## [101]  5.025  5.075  5.125  5.175  5.225  5.275  5.325  5.375  5.425  5.475
## [111]  5.525  5.575  5.625  5.675  5.725  5.775  5.825  5.875  5.925  5.975
## [121]  6.025  6.075  6.125  6.175  6.225  6.275  6.325  6.375  6.425  6.475
## [131]  6.525  6.575  6.625  6.675  6.725  6.775  6.825  6.875  6.925  6.975
## [141]  7.025  7.075  7.125  7.175  7.225  7.275  7.325  7.375  7.425  7.475
## [151]  7.525  7.575  7.625  7.675  7.725  7.775  7.825  7.875  7.925  7.975
## [161]  8.025  8.075  8.125  8.175  8.225  8.275  8.325  8.375  8.425  8.475
## [171]  8.525  8.575  8.625  8.675  8.725  8.775  8.825  8.875  8.925  8.975
## [181]  9.025  9.075  9.125  9.175  9.225  9.275  9.325  9.375  9.425  9.475
## [191]  9.525  9.575  9.625  9.675  9.725  9.775  9.825  9.875  9.925  9.975
## [201] 10.025 10.075 10.125 10.175 10.225 10.275 10.325 10.375 10.425 10.475
## [211] 10.525 10.575 10.625 10.675 10.725 10.775 10.825 10.875 10.925 10.975
## [221] 11.025 11.075 11.125 11.175 11.225 11.275 11.325 11.375 11.425 11.475
## [231] 11.525 11.575 11.625 11.675 11.725 11.775 11.825 11.875 11.925 11.975
## [241] 12.025 12.075 12.125 12.175 12.225 12.275
## 
## $xname
## [1] &quot;log1p(simvals)&quot;
## 
## $equidist
## [1] TRUE
## 
## attr(,&quot;class&quot;)
## [1] &quot;histogram&quot;</code></pre>
<p>We’ve got about 20% zero values, and the non-zero values have a median of 16 and a mean of about 1,700. Conceivably every country <em>could</em> receive deployments, but some are highly unlikely to (e.g. North Korea). But even countries that do host US personnel tend to host very small deployments, as you can see by the relatively small median value. The mean is dragged upwards by large, long-standing legacy deployments in places like Germany, Japan, and South Korea.</p>
</div>
<div id="problem" class="section level1">
<h1>Problem</h1>
<p>I’m glossing over a lot of the details here, but working on this has prompted me to think more about using hurdle models (like I already said). Yadda yadda yadda, this has led me to think about what a probability density function for a hurdle model looks like. The <code>{stats}</code> package in <code>R</code> comes with a set of functions for handling lognormal distributions, but doesn’t appear to have anything to handle hurdle variants. Riffing off of the aforementioned <code>{countreg}</code> package, this is my attempt to create something comparable for hurdle lognormal distributions (I couldn’t find one with Elaine).</p>
<div class="tenor-gif-embed" data-postid="5569195" data-share-method="host" data-width="100%" data-aspect-ratio="1.4821428571428572">
<a href="https://tenor.com/view/seinfeld-jason-alexander-george-costanza-yada-yada-yada-pissed-gif-5569195">Seinfeld Jason Alexander GIF</a> from <a href="https://tenor.com/search/seinfeld-gifs">Seinfeld GIFs</a>
</div>
<script type="text/javascript" async src="https://tenor.com/embed.js"></script>
</div>
<div id="attempt" class="section level1">
<h1>Attempt</h1>
<p>This is my shot at creating a probability density function…umm…function. I started with the builtin <code>dlnorm()</code> function, but the problem is that it only accepts positive values. If we have a lot of data that are failing to cross that hurdle (i.e. 0 values) then this doesn’t really work. I think the solution is to insert an argument that details the propotion/probability of 0 values in the data (i.e. the <code>pval</code> argument). For non-zero values we have to first get the probability using <code>dlnorm()</code>. Once we generate the probability value for the <code>x</code> value using <code>dlnorm()</code> we then have to weight that probability value by the proportion of non-zero values in the data. In this case we enter a <code>pval</code> argument of 0.2 since 20% of the data are 0s, but when we calculate the probabiltiy for some values &gt; 0 we want to make sure that’s weighted by 0.8 since 80% of observations are &gt; 0. If <code>x</code> equals zero then the probability should (I think?) just default to the <code>pval</code> argument.</p>
<pre class="r"><code>dhlnorm &lt;- function(x, meanlog, sdlog, pval) {
  
    if (x &gt; 0) {
    
    value &lt;- dlnorm(x, meanlog = meanlog, sdlog = sdlog, log = FALSE) * (1-pval)
    
    return(value)
    
  } else {
    
    value &lt;- pval
    
    return(value)
  }
  }


prob &lt;- dhlnorm(3, meanlog = muval, sdlog = sdval, pval = 0.2)

print(prob)</code></pre>
<pre><code>## [1] 0.03346686</code></pre>
<p>Again, this is very much on the frontiers of my experience, so if anyone has any feedback I’d appreciate it. I have some potential applications in mind, so this is more than just running down a rabbit hole.</p>
</div>
